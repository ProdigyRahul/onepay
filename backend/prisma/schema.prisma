generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String               @id @default(uuid())
  phoneNumber        String               @unique
  email              String?              @unique
  firstName          String
  lastName           String
  isVerified         Boolean              @default(false)
  role               Role                 @default(USER)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  isActive           Boolean              @default(true)
  onboardingComplete Boolean              @default(false)
  budgets            Budget[]
  financialProfile   FinancialProfile?
  gamification       GamificationProfile?
  kyc                KYC?
  learningProgress   LearningProgress[]
  notifications      Notification[]
  otps               OTP[]
  wallet             Wallet?

  @@map("users")
}

model OTP {
  id          String   @id @default(uuid())
  code        String
  phoneNumber String
  userId      String
  expiresAt   DateTime
  isUsed      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id])

  @@map("otps")
}

model KYC {
  id          String    @id @default(uuid())
  userId      String    @unique
  panNumber   String    @unique
  dateOfBirth DateTime
  status      KYCStatus @default(PENDING)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  panCardPath String?
  remarks     String?
  verifiedAt  DateTime?
  user        User      @relation(fields: [userId], references: [id])

  @@map("kyc")
}

model FinancialProfile {
  id                       String        @id @default(uuid())
  userId                   String        @unique
  incomeRange              IncomeRange
  targetSpendingPercentage Float
  spendingHabit            SpendingHabit
  targetSavingsPercentage  Float
  primaryGoal              UserGoal
  createdAt                DateTime      @default(now())
  updatedAt                DateTime      @updatedAt
  user                     User          @relation(fields: [userId], references: [id])

  @@map("financial_profiles")
}

model Wallet {
  id                String        @id @default(uuid())
  userId            String        @unique
  balance           Float         @default(0)
  pin               String
  pinAttempts       Int           @default(0)
  isBlocked         Boolean       @default(false)
  blockedUntil      DateTime?
  dailyLimit        Float         @default(10000)
  monthlyLimit      Float         @default(100000)
  currency          String        @default("USD")
  isActive          Boolean       @default(true)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  transactions      Transaction[]
  receivedTransfers Transfer[]    @relation("ReceiverWallet")
  sentTransfers     Transfer[]    @relation("SenderWallet")
  user              User          @relation(fields: [userId], references: [id])

  @@map("wallets")
}

model Transaction {
  id          String            @id @default(uuid())
  walletId    String
  type        TransactionType
  amount      Float
  balance     Float
  description String?
  status      TransactionStatus @default(PENDING)
  metadata    Json?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  wallet      Wallet            @relation(fields: [walletId], references: [id])

  @@map("transactions")
}

model Transfer {
  id               String         @id @default(uuid())
  amount           Float
  senderWalletId   String
  receiverWalletId String
  status           TransferStatus @default(PENDING)
  description      String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  receiverWallet   Wallet         @relation("ReceiverWallet", fields: [receiverWalletId], references: [id])
  senderWallet     Wallet         @relation("SenderWallet", fields: [senderWalletId], references: [id])

  @@map("transfers")
}

model Budget {
  id        String          @id @default(uuid())
  userId    String
  category  ExpenseCategory
  amount    Float
  spent     Float           @default(0)
  period    BudgetPeriod
  startDate DateTime
  endDate   DateTime
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  user      User            @relation(fields: [userId], references: [id])

  @@map("budgets")
}

model LearningProgress {
  id        String         @id @default(uuid())
  userId    String
  moduleId  String
  progress  Float          @default(0)
  completed Boolean        @default(false)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  module    LearningModule @relation(fields: [moduleId], references: [id])
  user      User           @relation(fields: [userId], references: [id])

  @@map("learning_progress")
}

model LearningModule {
  id          String             @id @default(uuid())
  title       String
  description String
  content     Json
  points      Int                @default(0)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  progress    LearningProgress[]

  @@map("learning_modules")
}

model GamificationProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  level     Int      @default(1)
  points    Int      @default(0)
  badges    String[] @default([])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@map("gamification_profiles")
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  title     String
  message   String
  type      NotificationType
  read      Boolean          @default(false)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  user      User             @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model ServerMetrics {
  id                String   @id @default(uuid())
  startTime         DateTime @default(now())
  lastRestartTime   DateTime @default(now())
  apiResponseTime   Float    @default(0)
  dbQueryTime       Float    @default(0)
  endpoint          String   @default("/health")
  timestamp         DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  historicalMetrics HistoricalMetric[]

  @@map("server_metrics")
  @@index([timestamp])
}

model HistoricalMetric {
  id              String        @id @default(uuid())
  serverMetricsId String
  apiResponseTime Float
  dbQueryTime     Float
  timestamp       DateTime      @default(now())
  serverMetrics   ServerMetrics @relation(fields: [serverMetricsId], references: [id])

  @@map("historical_metrics")
  @@index([timestamp])
}

enum Role {
  ADMIN
  USER
}

enum KYCStatus {
  PENDING
  VERIFIED
  REJECTED
  PENDING_VERIFICATION
}

enum TransactionType {
  CREDIT
  DEBIT
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
}

enum TransferStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
}

enum ExpenseCategory {
  FOOD
  TRANSPORT
  SHOPPING
  BILLS
  ENTERTAINMENT
  HEALTH
  EDUCATION
  OTHER
}

enum BudgetPeriod {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

enum NotificationType {
  TRANSACTION
  BUDGET_ALERT
  SYSTEM
  ACHIEVEMENT
}

enum IncomeRange {
  RANGE_0_25000
  RANGE_25000_100000
  RANGE_100000_300000
  RANGE_300000_PLUS
}

enum SpendingType {
  SPEND_ALL
  SPEND_NONE
  SPEND_SOMETIMES
}

enum PurposeType {
  PAYMENTS
  LOANS
  INVESTMENTS
  TRACKING
}

enum SpendingHabit {
  SPEND_ALL
  SPEND_NONE
  SPEND_SOMETIMES
  SAVE_MOST
}

enum UserGoal {
  EVERYDAY_PAYMENTS
  LOANS
  INVESTMENTS
  TRACK_EXPENSES
}
